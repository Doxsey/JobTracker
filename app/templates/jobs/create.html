{% from "macros/jobs_macros.html" import select_file_upload %} {% extends "base.html" %} {% block title %}Create Job -
Job
Tracker{% endblock %} {% block content %}
<div class="row justify-content-center">
  <div class="col-md-8">
    <h3>Add New Job</h3>
    <br />

    <form action="" method="post" enctype="multipart/form-data">
      {{ form.hidden_tag() }}
      <div class="container text-center">
        <div class="row">
          <div class="col">
            {{ form.company(size=32, class="form-control", placeholder="Company") }}
            <br />
          </div>
          <div class="col">
            <!-- prettier-ignore -->
            {{ form.title(size=32, class="form-control", placeholder="Job Title") }}
          </div>
        </div>

        <div class="row">
          <div class="col">{{ form.location(size=32, class="form-control", placeholder="Location") }}</div>
          <div class="col">
            <div class="row">
              <select class="form-select" name="remote_option" id="remote_option" aria-label="Default select example">
                <option value="">Select Remote Option</option>
                <option value="Remote">Remote</option>
                <option value="Hybrid">Hybrid</option>
                <option value="Onsite">Onsite</option>
                <option value="Unknown">Unknown</option>
              </select>
            </div>
          </div>
        </div>

        <div class="row mt-3">
          <div class="col">
            <div class="mb-3">
              <label for="description" class="form-label">Job Description</label>
              <div id="editor" style="height: 200px;"></div>
              {{ form.description(style="display: none;", id="description") }}
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col">
            {{ form.salary_range_low(size=32, class="form-control", placeholder="Salary Range Low") }}
            <br />
          </div>
          <div class="col">
            {{ form.salary_range_high(size=32, class="form-control", placeholder="Salary Range High") }}
          </div>
        </div>

        <div class="row">
          <div class="col">
            {{ form.company_website(size=32, class="form-control", placeholder="Company Website") }}
          </div>
          <div class="col">{{ form.posting_id(size=32, class="form-control", placeholder="Posting ID") }}</div>
        </div>

        <br />
        <div class="row">
          <div class="form-check d-flex justify-content-start mb-3">
            {% for setting in settings %}
            {% if setting.key == "default_resume" %}
            {{ form.use_default_resume(class="form-check-input me-3 ms-3", id="use_default_resume_checkbox") }}
            {{ form.use_default_resume.label(class="form-check-label") }}
            {% else %}
            <input class="form-check-input me-3 ms-3" type="checkbox" value="" id="checkIndeterminateDisabled"
              disabled />
            <label class="form-check-label" for="checkIndeterminateDisabled">
              Use Default Resume (Upload a default resume in settings)
            </label>

            {% endif %}
            {% endfor %}
          </div>
        </div>
        <div id="resume-file-container">
          {{ select_file_upload(form.resume_file, "Resume") }}
        </div>
        {{ select_file_upload(form.cover_letter_file, "Cover Letter") }}
        {{ select_file_upload(form.job_description_file, "Job Description") }}

        <br />
        <hr />
        <br />

        <div class="row">
          <div class="col">
            <h5 class="text-start">Referrer Information</h5>
            <br />
          </div>
        </div>

        <div class="row">
          <div class="col">
            {{ form.referrer(size=32, class="form-control", placeholder="Referrer") }}
            <br />
          </div>
          <div class="col">
            {{ form.referrer_posting_id(size=32, class="form-control", placeholder="Referrer Posting ID") }}
          </div>
        </div>

        <div class="row">
          <div class="col">
            {{ form.posting_url(size=32, class="form-control", placeholder="Posting URL") }}
            <br />
          </div>
        </div>

        <div class="mb-3">{{ form.submit(class="btn btn-success") }}</div>
      </div>
    </form>

    {% for field, errors in form.errors.items() %} {% for error in errors %}
    <div class="row">
      <div class="alert alert-danger">{{ field }}: {{ error }}</div>
    </div>
    {% endfor %} {% endfor %}
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const useDefaultResumeCheckbox = document.getElementById('use_default_resume_checkbox');
    const resumeFileContainer = document.getElementById('resume-file-container');

    function toggleResumeFileInput() {
      const resumeFileInput = resumeFileContainer.querySelector('input[type="file"]');
      const resumeFileLabel = resumeFileContainer.querySelector('label');
      const resumeFileDiv = resumeFileContainer.querySelector('div');

      if (useDefaultResumeCheckbox && useDefaultResumeCheckbox.checked) {
        // Disable the file input
        if (resumeFileInput) {
          resumeFileInput.disabled = true;
          resumeFileInput.value = ''; // Clear any selected file
        }
        // Add visual indication that it's disabled
        if (resumeFileDiv) {
          resumeFileDiv.style.opacity = '0.5';
          resumeFileDiv.style.pointerEvents = 'none';
        }
      } else {
        // Enable the file input
        if (resumeFileInput) {
          resumeFileInput.disabled = false;
        }
        // Remove visual indication
        if (resumeFileDiv) {
          resumeFileDiv.style.opacity = '1';
          resumeFileDiv.style.pointerEvents = 'auto';
        }
      }
    }

    // Initial state check
    toggleResumeFileInput();

    // Listen for checkbox changes
    if (useDefaultResumeCheckbox) {
      useDefaultResumeCheckbox.addEventListener('change', toggleResumeFileInput);
    }
  });
</script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Initialize rich text editor for job creation
    const descriptionEditor = new QuillEditor({
      editorId: 'editor',
      hiddenFieldId: 'description',
      placeholder: 'Enter detailed job description...',
      height: '200px',
      validation: {
        required: true,
        minLength: 10
      },
      onChange: (content, editor) => {
        console.log('Description changed:', content.length, 'characters');
      }
    });

    // Setup form validation
    const form = document.getElementById('job-form');
    if (form) {
      form.addEventListener('submit', (e) => {
        const validation = descriptionEditor.validate({
          required: true,
          minLength: 10
        });

        if (!validation.isValid) {
          e.preventDefault();
          alert('Description errors: ' + validation.errors.join(', '));
        }
      });
    }
  });
</script>

{% endblock %}